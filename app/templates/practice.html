{% extends "base.html" %}
{% block title %}Investigamer - Practice{% endblock %}
{% block content %}
<div class="container mx-auto py-8 px-4">
  <div class="bg-white shadow-md rounded-lg p-6">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Standalone lesson title for clear visibility and focus -->
    <div class="text-center">
      <h1 class="text-4xl font-bold mb-2 text-teal-800">{{ use_case.lesson_title }}</h1>
      <h2 class="text-2xl font-bold mb-4 text-teal-600">Practice Session</h2>
    </div>

    {% if is_similar_use_case %}
    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4" role="alert">
      <p class="font-bold">Heads Up! Similar Use Case Ahead</p>
      <p>This is your chance to correct a previous mistake. Practice makes perfect!</p>
    </div>
    {% endif %}

    <div class="use-case-container bg-gray-100 rounded-lg p-6 shadow-inner">
      <div id="progress-bar-container" class="mb-6">
        <div id="progress-bar" class="bg-green-500 text-xs font-medium text-white text-center py-1 rounded-full" style="width: 0%">0%</div>
      </div>
      <div id="remaining-use-cases" class="text-sm mb-4 text-right text-gray-600">
        Remaining use cases: <span id="remaining-count">Calculating...</span>
      </div>
      <!-- Trigger/Open The Modal -->
<button id="myBtn">Show News Article</button>

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <p id="news-article-content">Some text in the Modal..</p>
  </div>

</div>
      <div id="answer-feedback" class="hidden text-center py-2 px-4 rounded bg-red-500 text-white"></div>
      <p id="use-case-description" class="text-lg mb-4 text-gray-700">{{ use_case.description|safe }}</p>
      <form id="questions-form" action="/submit-answer" method="post" enctype="application/json">
        <input type="hidden" id="use_case_id" name="use_case_id" value="{{ use_case.id }}">
        <div id="questions-container">
          {% for question in use_case.questions %}
          <div class="mb-6">
            <p class="font-bold mb-2 text-gray-700">{{ question.text }}</p>
            {% for option in question.options %}
            <label class="block mb-2 cursor-pointer">
              <input type="radio" name="answer[{{ question.id }}]" value="{{ option.id }}" class="mr-2 leading-tight">
              {{ option.text }}
            </label>
            {% endfor %}
          </div>
          {% endfor %}
        </div>
        <button type="submit" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-full mt-4">
          Submit Answer
        </button>
      </form>
      <div class="text-xs text-gray-500 text-right mt-4">
        Lesson ID: {{ use_case.lesson_id }}, UseCase ID: {{ use_case.id }}
      </div>
      <div id="use-case-data" data-total-use-cases="{{ total_use_cases }}" data-completed-use-cases="{{ correct_use_cases }}"></div>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='cfa.js') }}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      let totalUseCases = {{ total_use_cases }};
      let completedUseCases = {{ correct_use_cases }};

      const progressBar = document.getElementById('progress-bar');
      const remainingCount = document.getElementById('remaining-count');
      const answerFeedback = document.getElementById('answer-feedback');
      const useCaseContainer = document.querySelector('.use-case-container');

      // Get the modal
      var modal = document.getElementById('myModal');
      var btn = document.getElementById('myBtn');
      var span = document.getElementsByClassName("close")[0];

      updateProgressBar();
      updateRemainingUseCases();

      function updateProgressBar() {
          let progressPercentage = (completedUseCases / totalUseCases) * 100;
          progressBar.style.width = `${progressPercentage}%`;
          progressBar.textContent = `${progressPercentage.toFixed(0)}%`;
      }

      function updateRemainingUseCases() {
          let remaining = totalUseCases - completedUseCases;
          remainingCount.textContent = remaining;
      }

      btn.onclick = function() {
        var useCaseId = document.getElementById('use_case_id').value;
        fetch(`/get-news-article?use_case_id=${useCaseId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('news-article-content').textContent = data.content;
                    modal.style.display = "block";
                } else {
                    alert(data.message);
                }
            });
       };

       span.onclick = function() {
           modal.style.display = "none";
       };

           // When the user clicks anywhere outside of the modal, close it
       window.onclick = function(event) {
           if (event.target == modal) {
              modal.style.display = "none";
       }
  };

  });

</script>
{% endblock %}